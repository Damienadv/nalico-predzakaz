<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NALICO - –ü—Ä–µ–¥–∑–∞–∫–∞–∑ —Ç–æ–≤–∞—Ä–æ–≤</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Vue 3 via CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- XLSX library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'nalico-pink': '#F9BFC5',
                        'nalico-pink-hover': '#f3aab3',
                        'nalico-milk': '#FFF5F5',
                        'nalico-brown': '#887D6D',
                        'nalico-dark-bg': '#1A1A1A',
                        'nalico-dark-card': '#252525',
                    },
                    fontFamily: {
                        'heading': ['Montserrat', 'sans-serif'],
                        'body': ['Inter', 'Segoe UI', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 4px 16px rgba(0, 0, 0, 0.06)',
                        'pink': '0 8px 24px rgba(249, 191, 197, 0.12)',
                    },
                    borderRadius: {
                        'card': '1rem',
                        'button': '0.75rem',
                    },
                }
            }
        }
    </script>
    
    <style>
        [v-cloak] {
            display: none;
        }
        
        body {
            font-family: 'Inter', 'Segoe UI', sans-serif;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Montserrat', sans-serif;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #F9BFC5;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #f3aab3;
        }

        /* Gradient text */
        .gradient-text {
            background: linear-gradient(135deg, #F9BFC5 0%, #f3aab3 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Multiple select styling */
        select[multiple] option:checked {
            background: linear-gradient(135deg, #F9BFC5 0%, #f3aab3 100%);
            color: white;
        }
    </style>
</head>
<body class="bg-white dark:bg-nalico-dark-bg transition-colors duration-300">
    <div id="app" v-cloak>
        <!-- Header -->
        <header class="bg-white dark:bg-nalico-dark-card border-b border-gray-200/20 dark:border-gray-800 shadow-soft sticky top-0 z-50 backdrop-blur-sm bg-white/90 dark:bg-nalico-dark-card/90">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 py-5">
                <div class="flex items-center justify-between flex-wrap gap-4">
                    <div class="flex items-center gap-4">
                        <h1 class="text-3xl sm:text-4xl font-heading font-bold tracking-wide gradient-text">
                            NALICO
                        </h1>
                        <span class="text-sm text-nalico-brown dark:text-gray-400 font-light hidden sm:inline">
                            –ü—Ä–µ–¥–∑–∞–∫–∞–∑ —Ç–æ–≤–∞—Ä–æ–≤
                        </span>
                    </div>
                    
                    <div class="flex items-center gap-3">
                        <!-- Auto-refresh toggle -->
                        <div class="flex items-center gap-2 px-3 py-2 bg-nalico-milk dark:bg-nalico-dark-bg rounded-xl">
                            <span class="text-xs text-nalico-brown dark:text-gray-400 hidden sm:inline">–ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</span>
                            <button 
                                @click="toggleAutoRefresh"
                                class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors duration-200"
                                :class="autoRefreshEnabled ? 'bg-nalico-pink' : 'bg-gray-300 dark:bg-gray-700'"
                            >
                                <span 
                                    class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform duration-200"
                                    :class="autoRefreshEnabled ? 'translate-x-6' : 'translate-x-1'"
                                ></span>
                            </button>
                        </div>
                        
                        <!-- Theme toggle -->
                        <button 
                            @click="toggleTheme"
                            class="p-2.5 rounded-xl bg-nalico-milk dark:bg-nalico-dark-bg hover:bg-nalico-pink/10 transition-all duration-200 hover:scale-105"
                        >
                            <svg v-if="!isDark" class="w-5 h-5 text-nalico-brown" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                            </svg>
                            <svg v-else class="w-5 h-5 text-nalico-pink" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                            </svg>
                        </button>
                    </div>
                </div>
                
                <!-- File info -->
                <div v-if="fileInfo" class="mt-3 text-xs text-nalico-brown dark:text-gray-400">
                    üìÑ {{ fileInfo }}
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 py-6 space-y-6">
            <!-- Error Message -->
            <div v-if="errorMessage" class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-card p-4 text-red-800 dark:text-red-300">
                {{ errorMessage }}
            </div>

            <!-- Stats Section -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div class="bg-white dark:bg-nalico-dark-card rounded-card shadow-soft p-6 border-t-4 border-nalico-pink hover:shadow-pink transition-all duration-300 transform hover:-translate-y-0.5">
                    <p class="text-sm text-nalico-brown dark:text-gray-400 font-light mb-2">
                        –í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤
                    </p>
                    <p class="text-3xl sm:text-4xl font-heading font-bold text-gray-900 dark:text-white">
                        {{ formatNumber(filteredProducts.length) }}
                    </p>
                </div>
                <div class="bg-white dark:bg-nalico-dark-card rounded-card shadow-soft p-6 border-t-4 border-green-500 hover:shadow-pink transition-all duration-300 transform hover:-translate-y-0.5">
                    <p class="text-sm text-nalico-brown dark:text-gray-400 font-light mb-2">
                        –í –Ω–∞–ª–∏—á–∏–∏
                    </p>
                    <p class="text-3xl sm:text-4xl font-heading font-bold text-gray-900 dark:text-white">
                        {{ formatNumber(inStockCount) }}
                    </p>
                </div>
            </div>

            <!-- Filters Panel -->
            <div class="bg-white dark:bg-nalico-dark-card rounded-card shadow-soft p-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <!-- Search -->
                    <div>
                        <label class="block text-sm font-medium text-nalico-brown dark:text-gray-400 mb-2">
                            üîç –ü–æ–∏—Å–∫
                        </label>
                        <input 
                            v-model="searchQuery"
                            type="text"
                            placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞..."
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 dark:border-gray-700 bg-nalico-milk dark:bg-nalico-dark-bg text-gray-900 dark:text-white placeholder-gray-500 focus:border-nalico-pink focus:ring-4 focus:ring-nalico-pink/15 transition-all outline-none"
                        />
                    </div>
                    
                    <!-- Brand Filter -->
                    <div>
                        <label class="block text-sm font-medium text-nalico-brown dark:text-gray-400 mb-2">
                            üè∑Ô∏è –ë—Ä–µ–Ω–¥ (–º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ)
                        </label>
                        <select 
                            v-model="selectedBrands"
                            multiple
                            size="5"
                            class="w-full px-4 py-2 rounded-xl border border-gray-200 dark:border-gray-700 bg-nalico-milk dark:bg-nalico-dark-bg text-gray-900 dark:text-white focus:border-nalico-pink focus:ring-4 focus:ring-nalico-pink/15 transition-all outline-none"
                        >
                            <option v-for="brand in availableBrands" :key="brand" :value="brand" class="py-1.5">
                                {{ brand }}
                            </option>
                        </select>
                    </div>
                    
                    <!-- Stock Filter -->
                    <div>
                        <label class="block text-sm font-medium text-nalico-brown dark:text-gray-400 mb-2">
                            üì¶ –ù–∞–ª–∏—á–∏–µ
                        </label>
                        <select
                            v-model="stockFilter"
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 dark:border-gray-700 bg-nalico-milk dark:bg-nalico-dark-bg text-gray-900 dark:text-white focus:border-nalico-pink focus:ring-4 focus:ring-nalico-pink/15 transition-all outline-none"
                        >
                            <option value="instock">–¢–æ–ª—å–∫–æ –≤ –Ω–∞–ª–∏—á–∏–∏</option>
                            <option value="all">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</option>
                        </select>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="flex gap-3 flex-wrap">
                    <button 
                        @click="loadExcelFile"
                        class="px-6 py-3 bg-nalico-pink hover:bg-nalico-pink-hover text-white font-medium rounded-button transition-all duration-200 hover:-translate-y-0.5 shadow-sm hover:shadow-pink"
                    >
                        üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å Excel
                    </button>
                    <button 
                        @click="exportToCSV"
                        class="px-6 py-3 bg-nalico-pink hover:bg-nalico-pink-hover text-white font-medium rounded-button transition-all duration-200 hover:-translate-y-0.5 shadow-sm hover:shadow-pink"
                    >
                        üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
                    </button>
                    <button 
                        @click="resetFilters"
                        class="px-6 py-3 border-2 border-nalico-pink text-nalico-pink hover:bg-nalico-milk dark:hover:bg-nalico-dark-bg font-medium rounded-button transition-all duration-200"
                    >
                        üîÑ –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                    </button>
                </div>
            </div>

            <!-- Products Table -->
            <div class="bg-white dark:bg-nalico-dark-card rounded-card shadow-soft overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-nalico-milk dark:bg-nalico-dark-bg">
                            <tr>
                                <th 
                                    v-for="col in columns" 
                                    :key="col.key"
                                    @click="sortBy(col.key)"
                                    class="px-4 sm:px-6 py-4 text-left text-xs sm:text-sm font-semibold text-nalico-brown dark:text-gray-400 cursor-pointer hover:bg-nalico-pink/10 transition-colors select-none"
                                    :class="col.class"
                                >
                                    <span class="flex items-center gap-2">
                                        {{ col.label }}
                                        <span v-if="sortColumn === col.key" class="text-nalico-pink">
                                            {{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}
                                        </span>
                                    </span>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-if="loading" class="border-t border-gray-100 dark:border-gray-800">
                                <td colspan="8" class="px-6 py-12 text-center text-nalico-brown dark:text-gray-400">
                                    <div class="flex items-center justify-center gap-3">
                                        <div class="w-8 h-8 border-4 border-nalico-pink border-t-transparent rounded-full animate-spin"></div>
                                        <span>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</span>
                                    </div>
                                </td>
                            </tr>
                            <tr v-else-if="filteredProducts.length === 0" class="border-t border-gray-100 dark:border-gray-800">
                                <td colspan="8" class="px-6 py-12 text-center text-nalico-brown dark:text-gray-400">
                                    –ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                                </td>
                            </tr>
                            <tr 
                                v-else
                                v-for="product in paginatedProducts" 
                                :key="product.article"
                                class="border-t border-gray-100 dark:border-gray-800 hover:bg-nalico-milk dark:hover:bg-nalico-dark-bg/50 transition-colors"
                            >
                                <td class="px-4 sm:px-6 py-4 font-semibold text-gray-900 dark:text-white text-sm">{{ product.brand }}</td>
                                <td class="px-4 sm:px-6 py-4 text-gray-900 dark:text-white text-sm">{{ product.name }}</td>
                                <td class="px-4 sm:px-6 py-4 font-bold text-gray-900 dark:text-white">{{ product.stock }}</td>
                                <td class="px-4 sm:px-6 py-4 text-sm text-gray-600 dark:text-gray-400 hidden lg:table-cell">{{ product.description || '‚Äî' }}</td>
                                <td class="px-4 sm:px-6 py-4 text-gray-900 dark:text-white hidden md:table-cell">{{ product.volume || '‚Äî' }}</td>
                                <td class="px-4 sm:px-6 py-4 font-bold text-nalico-pink">{{ formatPrice(product.rrp) }}</td>
                                <td class="px-4 sm:px-6 py-4 text-gray-900 dark:text-white">{{ formatPrice(product.price) }}</td>
                                <td class="px-4 sm:px-6 py-4">
                                    <span 
                                        class="inline-flex px-3 py-1 rounded-full text-xs font-medium transition-colors"
                                        :class="product.stock > 0 
                                            ? 'bg-green-50 text-green-700 dark:bg-green-900/30 dark:text-green-400' 
                                            : 'bg-red-50 text-red-700 dark:bg-red-900/30 dark:text-red-400'"
                                    >
                                        {{ product.stock > 0 ? '‚úì –í –Ω–∞–ª–∏—á–∏–∏' : '‚úó –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏' }}
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div v-if="totalPages > 1" class="px-6 py-4 border-t border-gray-100 dark:border-gray-800 flex items-center justify-between">
                    <div class="text-sm text-nalico-brown dark:text-gray-400">
                        –ü–æ–∫–∞–∑–∞–Ω–æ {{ (currentPage - 1) * itemsPerPage + 1 }} - {{ Math.min(currentPage * itemsPerPage, filteredProducts.length) }} –∏–∑ {{ filteredProducts.length }}
                    </div>
                    <div class="flex gap-2">
                        <button 
                            @click="currentPage--"
                            :disabled="currentPage === 1"
                            class="px-4 py-2 rounded-lg bg-nalico-milk dark:bg-nalico-dark-bg text-nalico-brown dark:text-gray-400 hover:bg-nalico-pink hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            –ù–∞–∑–∞–¥
                        </button>
                        <button 
                            @click="currentPage++"
                            :disabled="currentPage === totalPages"
                            class="px-4 py-2 rounded-lg bg-nalico-milk dark:bg-nalico-dark-bg text-nalico-brown dark:text-gray-400 hover:bg-nalico-pink hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            –í–ø–µ—Ä—ë–¥
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="max-w-7xl mx-auto px-4 sm:px-6 py-6 text-center text-sm text-nalico-brown dark:text-gray-400">
            ¬© 2024 NALICO. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
        </footer>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    // Data
                    allProducts: [],
                    loading: false,
                    errorMessage: '',
                    fileInfo: '',
                    
                    // Filters
                    searchQuery: '',
                    selectedBrands: [],
                    stockFilter: 'instock',
                    
                    // Sorting
                    sortColumn: null,
                    sortDirection: 'asc',
                    
                    // Pagination
                    currentPage: 1,
                    itemsPerPage: 50,
                    
                    // UI State
                    isDark: false,
                    autoRefreshEnabled: false,
                    autoRefreshInterval: null,
                    
                    // Table columns
                    columns: [
                        { key: 'brand', label: '–ë—Ä–µ–Ω–¥', class: '' },
                        { key: 'name', label: '–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ', class: '' },
                        { key: 'stock', label: '–û—Å—Ç–∞—Ç–æ–∫', class: '' },
                        { key: 'description', label: '–ö–∞—Ç–µ–≥–æ—Ä–∏—è', class: 'hidden lg:table-cell' },
                        { key: 'volume', label: '–û–±—ä–µ–º, –º–ª', class: 'hidden md:table-cell' },
                        { key: 'rrp', label: '–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏', class: '' },
                        { key: 'price', label: '–°—Ç–æ–∏–º–æ—Å—Ç—å, ‚ÇΩ', class: '' },
                        { key: 'status', label: '–°—Ç–∞—Ç—É—Å', class: '' },
                    ]
                }
            },
            computed: {
                availableBrands() {
                    return [...new Set(this.allProducts.map(p => p.brand))].sort();
                },
                filteredProducts() {
                    let products = this.allProducts;
                    
                    // Search filter
                    if (this.searchQuery) {
                        const query = this.searchQuery.toLowerCase();
                        products = products.filter(p => 
                            p.name.toLowerCase().includes(query) ||
                            p.brand.toLowerCase().includes(query) ||
                            (p.description && p.description.toLowerCase().includes(query)) ||
                            (p.article && p.article.toLowerCase().includes(query))
                        );
                    }
                    
                    // Brand filter
                    if (this.selectedBrands.length > 0) {
                        products = products.filter(p => this.selectedBrands.includes(p.brand));
                    }
                    
                    // Stock filter
                    if (this.stockFilter === 'instock') {
                        products = products.filter(p => p.stock > 0);
                    }
                    
                    // Sorting
                    if (this.sortColumn) {
                        products = [...products].sort((a, b) => {
                            let aVal = a[this.sortColumn];
                            let bVal = b[this.sortColumn];
                            
                            if (typeof aVal === 'string') {
                                aVal = aVal.toLowerCase();
                                bVal = bVal.toLowerCase();
                            }
                            
                            if (aVal < bVal) return this.sortDirection === 'asc' ? -1 : 1;
                            if (aVal > bVal) return this.sortDirection === 'asc' ? 1 : -1;
                            return 0;
                        });
                    }
                    
                    return products;
                },
                paginatedProducts() {
                    const start = (this.currentPage - 1) * this.itemsPerPage;
                    const end = start + this.itemsPerPage;
                    return this.filteredProducts.slice(start, end);
                },
                totalPages() {
                    return Math.ceil(this.filteredProducts.length / this.itemsPerPage);
                },
                inStockCount() {
                    return this.filteredProducts.filter(p => p.stock > 0).length;
                }
            },
            watch: {
                filteredProducts() {
                    this.currentPage = 1;
                }
            },
            methods: {
                // Load data from JSON
                async loadDataFromJSON() {
                    try {
                        this.loading = true;
                        this.errorMessage = '';
                        
                        const response = await fetch('./data.json');
                        if (!response.ok) {
                            throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å data.json');
                        }
                        
                        const data = await response.json();
                        this.allProducts = data.products;
                        
                        if (data.metadata) {
                            const date = new Date(data.metadata.updated);
                            this.fileInfo = `${data.metadata.filename} (–æ–±–Ω–æ–≤–ª—ë–Ω: ${date.toLocaleDateString('ru-RU')} ${date.toLocaleTimeString('ru-RU')})`;
                        }
                        
                        this.loading = false;
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                        this.errorMessage = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª data.json —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.';
                        this.loading = false;
                    }
                },
                
                // Load Excel file
                loadExcelFile() {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = '.xlsx,.xls';
                    
                    input.onchange = (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            this.processExcelFile(file);
                        }
                    };
                    
                    input.click();
                },
                
                // Process Excel file
                processExcelFile(file) {
                    const reader = new FileReader();
                    
                    reader.onload = (e) => {
                        try {
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                            const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                            
                            this.parseProducts(jsonData, file.name);
                            
                            const date = new Date(file.lastModified || Date.now());
                            this.fileInfo = `${file.name} (–∏–∑–º–µ–Ω—ë–Ω: ${date.toLocaleDateString('ru-RU')} ${date.toLocaleTimeString('ru-RU')})`;
                        } catch (error) {
                            this.errorMessage = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–∞: ' + error.message;
                            console.error(error);
                        }
                    };
                    
                    reader.onerror = () => {
                        this.errorMessage = '–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞';
                    };
                    
                    reader.readAsArrayBuffer(file);
                },
                
                // Parse products from Excel data
                parseProducts(data, filename) {
                    if (data.length < 2) {
                        this.errorMessage = '–§–∞–π–ª –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã—Ö';
                        return;
                    }
                    
                    // Find header row
                    let headerRowIndex = -1;
                    let headers = [];
                    
                    for (let i = 0; i < Math.min(5, data.length); i++) {
                        const row = data[i];
                        const hasHeaders = row.some(cell => {
                            const cellStr = String(cell || '').toLowerCase().trim();
                            return cellStr.includes('–±—Ä–µ–Ω–¥') || 
                                   cellStr.includes('–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ') || 
                                   cellStr.includes('–æ—Å—Ç–∞—Ç–æ–∫');
                        });
                        
                        if (hasHeaders) {
                            headerRowIndex = i;
                            headers = row;
                            break;
                        }
                    }
                    
                    if (headerRowIndex === -1) {
                        this.errorMessage = '–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤ —Ñ–∞–π–ª–µ';
                        return;
                    }
                    
                    // Map columns
                    const columnMap = {
                        brand: -1,
                        name: -1,
                        description: -1,
                        article: -1,
                        volume: -1,
                        rrp: -1,
                        price: -1,
                        order: -1,
                        total: -1,
                        stock: -1
                    };
                    
                    headers.forEach((header, index) => {
                        const h = String(header || '').toLowerCase().trim();
                        if (h.includes('–±—Ä–µ–Ω–¥')) columnMap.brand = index;
                        else if (h.includes('–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ')) columnMap.name = index;
                        else if (h.includes('–∞—Ä—Ç–∏–∫—É–ª')) columnMap.article = index;
                        else if (h.includes('–æ–±—ä–µ–º')) columnMap.volume = index;
                        else if (h.includes('—Ä—Ä—Ü')) columnMap.rrp = index;
                        else if (h.includes('—Å—Ç–æ–∏–º–æ—Å—Ç—å')) columnMap.price = index;
                        else if (h.includes('–∑–∞–∫–∞–∑')) columnMap.order = index;
                        else if (h.includes('–∏—Ç–æ–≥–æ')) columnMap.total = index;
                        else if (h.includes('–æ—Å—Ç–∞—Ç–æ–∫')) columnMap.stock = index;
                    });
                    
                    if (columnMap.name >= 0 && columnMap.name + 1 < headers.length) {
                        const nextCol = String(headers[columnMap.name + 1] || '').trim();
                        if (!nextCol || nextCol === '') {
                            columnMap.description = columnMap.name + 1;
                        }
                    }
                    
                    // Parse rows
                    this.allProducts = [];
                    for (let i = headerRowIndex + 1; i < data.length; i++) {
                        const row = data[i];
                        if (!row || row.length === 0) continue;
                        
                        const brand = columnMap.brand >= 0 ? String(row[columnMap.brand] || '').trim() : '';
                        const name = columnMap.name >= 0 ? String(row[columnMap.name] || '').trim() : '';
                        const description = columnMap.description >= 0 ? String(row[columnMap.description] || '').trim() : '';
                        const article = columnMap.article >= 0 ? String(row[columnMap.article] || '').trim() : '';
                        
                        const volume = columnMap.volume >= 0 ? parseFloat(String(row[columnMap.volume] || '0').replace(/[^\d.-]/g, '')) || 0 : 0;
                        const rrp = columnMap.rrp >= 0 ? parseFloat(String(row[columnMap.rrp] || '0').replace(/[^\d.-]/g, '')) || 0 : 0;
                        const price = columnMap.price >= 0 ? parseFloat(String(row[columnMap.price] || '0').replace(/[^\d.-]/g, '')) || 0 : 0;
                        const order = columnMap.order >= 0 ? parseInt(String(row[columnMap.order] || '0').replace(/[^\d-]/g, '')) || 0 : 0;
                        const total = columnMap.total >= 0 ? parseFloat(String(row[columnMap.total] || '0').replace(/[^\d.-]/g, '')) || 0 : 0;
                        const stock = columnMap.stock >= 0 ? parseInt(String(row[columnMap.stock] || '0').replace(/[^\d-]/g, '')) || 0 : 0;
                        
                        if (!brand && !name) continue;
                        
                        this.allProducts.push({
                            brand,
                            name,
                            description,
                            article: article || description,
                            volume,
                            rrp,
                            price,
                            order,
                            total,
                            stock
                        });
                    }
                    
                    this.errorMessage = '';
                },
                
                // Export to CSV
                exportToCSV() {
                    if (this.filteredProducts.length === 0) {
                        alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞');
                        return;
                    }
                    
                    const headers = ['–ë—Ä–µ–Ω–¥', '–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ', '–û—Å—Ç–∞—Ç–æ–∫ —Å–∫–ª–∞–¥', '–ö–∞—Ç–µ–≥–æ—Ä–∏—è', '–û–±—ä–µ–º –º–ª', '–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏', '–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä—É–±'];
                    const rows = this.filteredProducts.map(p => [
                        p.brand,
                        p.name,
                        p.stock,
                        p.description || '',
                        p.volume,
                        p.rrp,
                        p.price
                    ]);
                    
                    const csvContent = [
                        headers.join(','),
                        ...rows.map(row => row.map(cell => `"${cell}"`).join(','))
                    ].join('\n');
                    
                    const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = `nalico_export_${new Date().toISOString().split('T')[0]}.csv`;
                    link.click();
                },
                
                // Sort by column
                sortBy(column) {
                    if (this.sortColumn === column) {
                        this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';
                    } else {
                        this.sortColumn = column;
                        this.sortDirection = 'asc';
                    }
                },
                
                // Reset filters
                resetFilters() {
                    this.searchQuery = '';
                    this.selectedBrands = [];
                    this.stockFilter = 'instock';
                    this.sortColumn = null;
                    this.sortDirection = 'asc';
                },
                
                // Toggle theme
                toggleTheme() {
                    this.isDark = !this.isDark;
                    if (this.isDark) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                    localStorage.setItem('theme', this.isDark ? 'dark' : 'light');
                },
                
                // Toggle auto-refresh
                toggleAutoRefresh() {
                    this.autoRefreshEnabled = !this.autoRefreshEnabled;
                    if (this.autoRefreshEnabled) {
                        this.autoRefreshInterval = setInterval(() => {
                            this.loadDataFromJSON();
                        }, 30000);
                    } else {
                        if (this.autoRefreshInterval) {
                            clearInterval(this.autoRefreshInterval);
                            this.autoRefreshInterval = null;
                        }
                    }
                },
                
                // Format number
                formatNumber(num) {
                    return num.toLocaleString('ru-RU');
                },
                
                // Format price
                formatPrice(price) {
                    if (!price) return '‚Äî';
                    return price.toLocaleString('ru-RU') + ' ‚ÇΩ';
                }
            },
            mounted() {
                // Load theme from localStorage
                const savedTheme = localStorage.getItem('theme') || 'light';
                this.isDark = savedTheme === 'dark';
                if (this.isDark) {
                    document.documentElement.classList.add('dark');
                }
                
                // Load data
                this.loadDataFromJSON();
            }
        }).mount('#app');
    </script>
</body>
</html>
